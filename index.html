<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valist - Minhas Avalia√ß√µes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #14181c;
            color: #9ab;
            line-height: 1.6;
        }

        .header {
            background-color: #1c2228;
            border-bottom: 1px solid #2c3440;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #5ac8fa;
            text-decoration: none;
            letter-spacing: -0.5px;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: #9ab;
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.2s;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: #5ac8fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .hero {
            text-align: center;
            margin-bottom: 4rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            color: #fff;
            margin-bottom: 0.5rem;
        }

        .hero p {
            font-size: 1.1rem;
            color: #678;
        }

        .category-section {
            margin-bottom: 4rem;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #2c3440;
        }

        .category-header h2 {
            color: #fff;
            font-size: 1.5rem;
        }

        .view-all {
            color: #5ac8fa;
            text-decoration: none;
            font-size: 0.9rem;
            transition: opacity 0.2s;
        }

        .view-all:hover {
            opacity: 0.8;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
        }

        .item-card {
            background-color: #1c2228;
            border-radius: 8px;
            overflow: visible;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            position: relative;
        }

        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(90, 200, 250, 0.1);
        }

        .quality-seal {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 150px;
            height: 150px;
            z-index: 10;
            background-color: transparent;
        }

        .quality-seal img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .item-image {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            background-color: #2c3440;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3440 0%, #1c2228 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #445566;
        }

        .item-info {
            padding: 1rem;
        }

        .item-name {
            font-weight: 600;
            color: #fff;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .item-rating {
            background-color: #5ac8fa;
            color: #14181c;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 700;
        }

        .item-date {
            color: #678;
        }

        .filters {
            background-color: #1c2228;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .filter-group label {
            font-size: 0.85rem;
            color: #678;
        }

        .filter-group input,
        .filter-group select {
            background-color: #2c3440;
            border: 1px solid #445566;
            color: #9ab;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #5ac8fa;
        }

        .category-page-header {
            margin-bottom: 2rem;
        }

        .category-page-header h1 {
            color: #fff;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stats {
            color: #678;
            font-size: 0.95rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(20, 24, 28, 0.9);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: #1c2228;
            margin: 2% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            gap: 2rem;
            padding: 2rem;
            border-bottom: 1px solid #2c3440;
            position: relative;
        }

        .modal-image {
            flex-shrink: 0;
            width: 200px;
            aspect-ratio: 2/3;
            border-radius: 8px;
            overflow: hidden;
            background-color: #2c3440;
            position: relative;
        }

        .modal-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-quality-seal {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 60px;
            height: 60px;
            z-index: 10;
        }

        .modal-quality-seal img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .modal-header-info {
            flex: 1;
        }

        .modal-title {
            color: #fff;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .modal-rating {
            display: inline-block;
            background-color: #5ac8fa;
            color: #14181c;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .modal-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .modal-meta-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .modal-meta-label {
            color: #678;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-meta-value {
            color: #fff;
            font-size: 1.1rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-description {
            color: #9ab;
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .close {
            color: #678;
            position: absolute;
            right: 2rem;
            top: 2rem;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close:hover {
            color: #5ac8fa;
        }

        /* Stats Page Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background-color: #1c2228;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #2c3440;
            transition: border-color 0.2s;
        }

        .stat-card:hover {
            border-color: #5ac8fa;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            color: #5ac8fa;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #9ab;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-unit {
            color: #678;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .chart-container {
            background-color: #1c2228;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .chart-title {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
        }

        #activityChart {
            width: 100%;
            height: 400px;
        }

        @media (max-width: 1024px) {
            .items-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .items-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 1rem;
            }
            
            .nav-links {
                gap: 1rem;
                font-size: 0.85rem;
            }

            .modal-header {
                flex-direction: column;
                align-items: center;
            }

            .modal-image {
                width: 150px;
            }

            .modal-meta {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .items-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav-container">
            <a href="#" class="logo" onclick="showPage('home')">Valist</a>
            <ul class="nav-links">
                <li><a href="#" class="active" onclick="showPage('home')">In√≠cio</a></li>
                <li><a href="#" onclick="showPage('restaurantes')">Restaurantes</a></li>
                <li><a href="#" onclick="showPage('livros')">Livros</a></li>
                <li><a href="#" onclick="showPage('animes')">Animes</a></li>
                <li><a href="#" onclick="showPage('games', this)">Games</a></li>
                <li><a href="#" onclick="showPage('series-filmes', this)">S√©ries/Filmes</a></li>
                <li><a href="#" onclick="showPage('stats')">Estat√≠sticas</a></li>
            </ul>
        </nav>
    </header>

    <main id="main-content"></main>

    <!-- Modal -->
    <div id="itemModal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        let allData = [];
        const CATEGORIES = {
            'restaurantes': 'Restaurantes',
            'livros': 'Livros',
            'animes': 'Animes',
            'games': 'Games',
            'series-filmes': 'S√©ries/Filmes'
        };

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header.trim()] = values[index]?.trim() || '';
                });
                obj.nota = parseFloat(obj.nota);
                obj.tamanho = parseInt(obj.tamanho);
                obj.ano = parseInt(obj.ano);
                obj.id = parseInt(obj.id);
                const seloValue = obj.selo_de_qualidade?.trim();
                obj.selo_de_qualidade = (seloValue === '1' || seloValue === 1) ? 1 : 0;
                return obj;
            });
        }

        function loadData() {
            fetch('data.csv')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro ao carregar o CSV');
                    }
                    return response.text();
                })
                .then(csv => {
                    allData = parseCSV(csv);
                    showPage('home');
                })
                .catch(err => {
                    console.error(err);
                    alert('N√£o foi poss√≠vel carregar o arquivo data.csv');
                });
        }

        function getImagePath(id) {
            return `images/${id}.jpg`;
        }

        function createItemCard(item) {
            console.log(`Item ${item.id} (${item.nome}): selo_de_qualidade = ${item.selo_de_qualidade}`);
            const sealHtml = item.selo_de_qualidade === 1 
                ? '<div class="quality-seal"><img src="images/selovalidequalidade.png" alt="Selo de Qualidade" onerror="console.log(\'Erro ao carregar o seal\')"></div>' 
                : '';
            
            return `
                <div class="item-card" onclick="openModal(${item.id})" data-seal="${item.selo_de_qualidade}">
                    ${sealHtml}
                    <div class="item-image">
                        <img src="${getImagePath(item.id)}" 
                             alt="${item.nome}"
                             onerror="this.parentElement.innerHTML='<div class=\\'placeholder\\'>üì∑</div>'">
                    </div>
                    <div class="item-info">
                        <div class="item-name" title="${item.nome}">${item.nome}</div>
                        <div class="item-meta">
                            <span class="item-rating">${item.nota.toFixed(1)}</span>
                            <span class="item-date">${new Date(item.data_avaliacao).toLocaleDateString('pt-BR', {month: 'short', year: 'numeric'})}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function getTopItems(categoria, limit = 5) {
            return allData
                .filter(item => item.categoria === categoria)
                .sort((a, b) => {
                    if (b.nota !== a.nota) return b.nota - a.nota;
                    return new Date(b.data_avaliacao) - new Date(a.data_avaliacao);
                })
                .slice(0, limit);
        }

        function showHomePage() {
            const categories = Object.keys(CATEGORIES);
            let html = `
                <div class="container">
                    <div class="hero">
                        <h1>Valist</h1>
                        <p>Minhas avalia√ß√µes pessoais de restaurantes, livros, animes, games e s√©ries/filmes</p>
                    </div>
            `;

            categories.forEach(cat => {
                const topItems = getTopItems(cat);
                if (topItems.length === 0) return;

                html += `
                    <section class="category-section">
                        <div class="category-header">
                            <h2>${CATEGORIES[cat]}</h2>
                            <a href="#" class="view-all" onclick="showPage('${cat}')">Ver todos ‚Üí</a>
                        </div>
                        <div class="items-grid">
                            ${topItems.map(item => createItemCard(item)).join('')}
                        </div>
                    </section>
                `;
            });

            html += '</div>';
            document.getElementById('main-content').innerHTML = html;
        }

        function showCategoryPage(categoria) {
            const categoryData = allData.filter(item => item.categoria === categoria);
            
            let html = `
                <div class="container">
                    <div class="category-page-header">
                        <h1>${CATEGORIES[categoria]}</h1>
                        <p class="stats">${categoryData.length} itens avaliados</p>
                    </div>

                    <div class="filters">
                        <div class="filter-group">
                            <label>Buscar</label>
                            <input type="text" id="searchInput" placeholder="Nome do item..." onkeyup="applyFilters()">
                        </div>
                        <div class="filter-group">
                            <label>Nota m√≠nima</label>
                            <input type="number" id="minRating" min="0" max="10" step="0.5" placeholder="0" onchange="applyFilters()">
                        </div>
                        <div class="filter-group">
                            <label>Nota m√°xima</label>
                            <input type="number" id="maxRating" min="0" max="10" step="0.5" placeholder="10" onchange="applyFilters()">
                        </div>
                        <div class="filter-group">
                            <label>Ordenar por</label>
                            <select id="sortBy" onchange="applyFilters()">
                                <option value="nota-desc">Nota (maior)</option>
                                <option value="nota-asc">Nota (menor)</option>
                                <option value="nome-asc">Nome (A-Z)</option>
                                <option value="nome-desc">Nome (Z-A)</option>
                                <option value="data-desc">Data (recente)</option>
                                <option value="data-asc">Data (antiga)</option>
                            </select>
                        </div>
                    </div>

                    <div id="filteredItems" class="items-grid"></div>
                </div>
            `;

            document.getElementById('main-content').innerHTML = html;
            window.currentCategory = categoria;
            applyFilters();
        }

        function applyFilters() {
            const search = document.getElementById('searchInput')?.value.toLowerCase() || '';
            const minRating = parseFloat(document.getElementById('minRating')?.value) || 0;
            const maxRating = parseFloat(document.getElementById('maxRating')?.value) || 10;
            const sortBy = document.getElementById('sortBy')?.value || 'nota-desc';

            let filtered = allData.filter(item => 
                item.categoria === window.currentCategory &&
                item.nome.toLowerCase().includes(search) &&
                item.nota >= minRating &&
                item.nota <= maxRating
            );

            const parts = sortBy.split('-');
            const order = parts.pop();
            const field = parts.join('-');
            filtered.sort((a, b) => {
                let comparison = 0;
                if (field === 'nota') {
                    comparison = a.nota - b.nota;
                } else if (field === 'nome') {
                    comparison = a.nome.localeCompare(b.nome);
                } else if (field === 'data') {
                    comparison = new Date(a.data_avaliacao) - new Date(b.data_avaliacao);
                }
                return order === 'desc' ? -comparison : comparison;
            });

            document.getElementById('filteredItems').innerHTML = 
                filtered.map(item => createItemCard(item)).join('') || 
                '<p style="color: #678; text-align: center; padding: 2rem;">Nenhum item encontrado.</p>';
        }

        function showPage(page, el) {
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            if (el) el.classList.add('active');

            if (page === 'home') {
                showHomePage();
            } else if (page === 'stats') {
                showStatsPage();
            } else {
                showCategoryPage(page);
            }
        }

        // Modal functions
        function openModal(itemId) {
            const item = allData.find(i => i.id == itemId);
            if (!item) return;

            const categoryName = CATEGORIES[item.categoria];
            const unitLabel = item.unidade_tamanho === 'p√°ginas' ? 'P√°ginas' :
                            item.unidade_tamanho === 'epis√≥dios' ? 'Epis√≥dios' :
                            item.unidade_tamanho === 'horas' ? 'Horas' :
                            item.unidade_tamanho === 'minutos' ? 'Minutos' : 'Unidades';

            const sealHtml = item.selo_de_qualidade === 1 
                ? '<div class="modal-quality-seal"><img src="images/selovalidequalidade.png" alt="Selo de Qualidade"></div>' 
                : '';

            const modalHTML = `
                <div class="modal-header">
                    <div class="modal-image">
                        ${sealHtml}
                        <img src="${getImagePath(item.id)}" 
                             alt="${item.nome}"
                             onerror="this.parentElement.innerHTML='<div class=\\'placeholder\\' style=\\'font-size: 4rem;\\'>üì∑</div>'">
                    </div>
                    <div class="modal-header-info">
                        <h2 class="modal-title">${item.nome}</h2>
                        <div class="modal-rating">${item.nota.toFixed(1)}/10</div>
                        <div class="modal-meta">
                            <div class="modal-meta-item">
                                <span class="modal-meta-label">Categoria</span>
                                <span class="modal-meta-value">${categoryName}</span>
                            </div>
                            <div class="modal-meta-item">
                                <span class="modal-meta-label">${unitLabel}</span>
                                <span class="modal-meta-value">${item.tamanho} ${item.unidade_tamanho}</span>
                            </div>
                            <div class="modal-meta-item">
                                <span class="modal-meta-label">Ano</span>
                                <span class="modal-meta-value">${item.ano}</span>
                            </div>
                            <div class="modal-meta-item">
                                <span class="modal-meta-label">Avaliado em</span>
                                <span class="modal-meta-value">${new Date(item.data_avaliacao).toLocaleDateString('pt-BR')}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    <p class="modal-description">${item.descricao}</p>
                </div>
            `;

            document.getElementById('modalBody').innerHTML = modalHTML;
            document.getElementById('itemModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(event) {
            if (!event || event.target.id === 'itemModal' || event.target.className === 'close') {
                document.getElementById('itemModal').style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Stats page
        function showStatsPage() {
            const stats = calculateStats();
            const monthlyData = getMonthlyData();

            let html = `
                <div class="container">
                    <div class="hero">
                        <h1>Estat√≠sticas</h1>
                        <p>Um resumo de todas as suas avalia√ß√µes</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${stats.totalPaginas.toLocaleString('pt-BR')}</div>
                            <div class="stat-label">P√°ginas Lidas</div>
                            <div class="stat-unit">${stats.totalLivros} livros</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.totalHoras.toLocaleString('pt-BR')}</div>
                            <div class="stat-label">Horas Jogadas</div>
                            <div class="stat-unit">${stats.totalGames} games</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.totalEpisodios.toLocaleString('pt-BR')}</div>
                            <div class="stat-label">Epis√≥dios Vistos</div>
                            <div class="stat-unit">${stats.totalAnimes} animes + ${stats.totalSeriesFilmes} s√©ries/filmes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.totalRestaurantes}</div>
                            <div class="stat-label">Restaurantes</div>
                            <div class="stat-unit">visitados</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3 class="chart-title">Atividade ao Longo do Ano</h3>
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>
            `;

            document.getElementById('main-content').innerHTML = html;
            renderChart(monthlyData);
        }

        function calculateStats() {
            const livros = allData.filter(i => i.categoria === 'livros');
            const games = allData.filter(i => i.categoria === 'games');
            const animes = allData.filter(i => i.categoria === 'animes');
            const seriesFilmes = allData.filter(i => i.categoria === 'series-filmes');
            const restaurantes = allData.filter(i => i.categoria === 'restaurantes');

            return {
                totalPaginas: livros.reduce((sum, i) => sum + i.tamanho, 0),
                totalLivros: livros.length,
                totalHoras: games.reduce((sum, i) => sum + i.tamanho, 0),
                totalGames: games.length,
                totalEpisodios: animes.reduce((sum, i) => sum + i.tamanho, 0) + 
                               seriesFilmes.reduce((sum, i) => sum + i.tamanho, 0),
                totalAnimes: animes.length,
                totalSeriesFilmes: seriesFilmes.length,
                totalRestaurantes: restaurantes.length
            };
        }

        function getMonthlyData() {
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const data = {
                labels: months,
                datasets: []
            };

            const categories = [
                { key: 'restaurantes', label: 'Restaurantes', color: '#ff6b6b' },
                { key: 'livros', label: 'Livros', color: '#4ecdc4' },
                { key: 'animes', label: 'Animes', color: '#ffe66d' },
                { key: 'games', label: 'Games', color: '#a8e6cf' },
                { key: 'series-filmes', label: 'S√©ries/Filmes', color: '#ff8b94' }
            ];

            categories.forEach(cat => {
                const monthCounts = new Array(12).fill(0);
                
                allData.filter(i => i.categoria === cat.key).forEach(item => {
                    const month = new Date(item.data_avaliacao).getMonth();
                    monthCounts[month]++;
                });

                data.datasets.push({
                    label: cat.label,
                    data: monthCounts,
                    backgroundColor: cat.color,
                    borderColor: cat.color,
                    borderWidth: 2
                });
            });

            return data;
        }

        function renderChart(data) {
            const canvas = document.getElementById('activityChart');
            const ctx = canvas.getContext('2d');
            
            const padding = 60;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            const barWidth = chartWidth / (data.labels.length * data.datasets.length + data.labels.length);
            const maxValue = Math.max(...data.datasets.flatMap(d => d.data));

            canvas.width = canvas.offsetWidth;
            canvas.height = 400;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = '#2c3440';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
                
                ctx.fillStyle = '#678';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText(Math.round(maxValue - (maxValue / 5) * i), padding - 10, y + 4);
            }

            data.labels.forEach((label, i) => {
                data.datasets.forEach((dataset, j) => {
                    const value = dataset.data[i];
                    const barHeight = (value / maxValue) * chartHeight;
                    const x = padding + i * (barWidth * data.datasets.length + barWidth) + j * barWidth;
                    const y = padding + chartHeight - barHeight;

                    ctx.fillStyle = dataset.backgroundColor;
                    ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                });

                ctx.fillStyle = '#9ab';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                const labelX = padding + i * (barWidth * data.datasets.length + barWidth) + (barWidth * data.datasets.length) / 2;
                ctx.fillText(label, labelX, canvas.height - padding + 20);
            });

            const legendY = 20;
            let legendX = padding;
            data.datasets.forEach((dataset, i) => {
                ctx.fillStyle = dataset.backgroundColor;
                ctx.fillRect(legendX, legendY, 15, 15);
                
                ctx.fillStyle = '#9ab';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText(dataset.label, legendX + 20, legendY + 12);
                
                legendX += ctx.measureText(dataset.label).width + 40;
            });
        }

        loadData();
    </script>
</body>
</html>
